# pm_pcsgen 環境定義書 ファイル形式バージョン: 1.1,,,,,,,,,,,,,
#表 1-1 クラスタ設定　…　クラスタ・ノード属性,,,,,,,,,,,,,
,NODE,,,,,,,,,,,,
,,uname,,type,,name,,value,,,,,
#,,ノード名,,パラメータ種別,,項目,,設定内容,,,備考,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#表 2-1 クラスタ設定　…　クラスタ・プロパティ,,,,,,,,,,,,,
,PROPERTY,,,,,,,,,,,,
,,name,,value,,,,,,,,,
#,,項目,,設定内容,,,概要,,,,備考,,
,,priority-fencing-delay,,10s,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#表 3-1 クラスタ設定　…　リソース・デフォルト,,,,,,,,,,,,,
,RSC_DEFAULTS,,,,,,,,,,,,
,,name,,value,,,,,,,,,
#,,項目,,設定内容,,,概要,,,,備考,,
,,resource-stickiness,,200,,,リソース割当て,,,,,,
,,migration-threshold,,1,,,リソース故障可能回数,,,,,,
,,,,,,,,,,,,,
#表 3-2 クラスタ設定　…　オペレーション・デフォルト,,,,,,,,,,,,,
,OP_DEFAULTS,,,,,,,,,,,,
,,name,,value,,,,,,,,,
#,,項目,,設定内容,,,概要,,,,備考,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#表 4-1 クラスタ設定　…　リソース構成,,,,,,,,,,,,,
,RESOURCES,,,,,,,,,,,,
,,resourceItem,resourceItem,resourceItem,id,,,,,,,,
#,,リソース構成要素,,,リソースID,,,概要,,,備考,,
,,Group,,,pgsql-group,,,,,,,,
,,,Primitive,,filesystem1,,,,,,,,
,,,Primitive,,filesystem2,,,,,,,,
,,,Primitive,,filesystem3,,,,,,,,
,,,Primitive,,ipaddr,,,,,,,,
,,,Primitive,,pgsql,,,,,,,,
,,Clone,,,ping-clone,,,,,,,,
,,,Primitive,,ping,,,,,,,,
,,Stonith,,,fence1-ipmilan,,,,,,,,
,,Stonith,,,fence2-ipmilan,,,,,,,,
,,,,,,,,,,,,,
#表 5-1 クラスタ設定　…　リソース・パラメータ (meta),,,,,,,,,,,,,
,RSC_ATTRIBUTES,,,,,,,,,,,,
,,id,,name,,,value,,,,,,
#,,リソースID,,項目,,,設定内容,,,備考,,,
,,pgsql-group,,priority,,,1,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#表 6-1 クラスタ設定　…　STONITHの実行順序,,,,,,,,,,,,,
,STONITH_LEVEL,,,,,,,,,,,,
,,node,,id,,,level,,,,,,
#,,STONITH対象ノード,,実行するSTONITHリソースID,,,実行順序,,,備考,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#表 7-1 クラスタ設定　…　Primitiveリソース,,,,,,,,,,,,,
,PRIMITIVE,,,,,,,,,,,,
,P,id,,class,,provider,,type,,,,,
#,,リソースID,,class,,provider,,type,,概要,,,
,,filesystem1,,ocf,,heartbeat,,Filesystem,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,options,device,,{{ PG_FILESYSTEMS[0].device }},,,,,,,,
,,,directory,,{{ PG_FILESYSTEMS[0].mountpoint }},,,,,,,,
,,,fstype,,xfs,,,,,,,,
,,,force_unmount,,safe,,,,,,,,
,O,type,timeout,,interval,,on-fail,,role,,start-delay,,
#,,オペレーション,タイムアウト値,,監視間隔,,障害時の動作,,役割,,起動前待機時間,備考,
,,start,60s,,,,restart,,,,,,
,,monitor,60s,,10s,,restart,,,,,,
,,stop,60s,,,,fence,,,,,,
,,,,,,,,,,,,,
,PRIMITIVE,,,,,,,,,,,,
,P,id,,class,,provider,,type,,,,,
#,,リソースID,,class,,provider,,type,,概要,,,
,,filesystem2,,ocf,,heartbeat,,Filesystem,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,options,device,,{{ PG_FILESYSTEMS[1].device }},,,,,,,,
,,,directory,,{{ PG_FILESYSTEMS[1].mountpoint }},,,,,,,,
,,,fstype,,xfs,,,,,,,,
,,,force_unmount,,safe,,,,,,,,
,O,type,timeout,,interval,,on-fail,,role,,start-delay,,
#,,オペレーション,タイムアウト値,,監視間隔,,障害時の動作,,役割,,起動前待機時間,備考,
,,start,60s,,,,restart,,,,,,
,,monitor,60s,,10s,,restart,,,,,,
,,stop,60s,,,,fence,,,,,,
,,,,,,,,,,,,,
,PRIMITIVE,,,,,,,,,,,,
,P,id,,class,,provider,,type,,,,,
#,,リソースID,,class,,provider,,type,,概要,,,
,,filesystem3,,ocf,,heartbeat,,Filesystem,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,options,device,,{{ PG_FILESYSTEMS[2].device }},,,,,,,,
,,,directory,,{{ PG_FILESYSTEMS[2].mountpoint }},,,,,,,,
,,,fstype,,xfs,,,,,,,,
,,,force_unmount,,safe,,,,,,,,
,O,type,timeout,,interval,,on-fail,,role,,start-delay,,
#,,オペレーション,タイムアウト値,,監視間隔,,障害時の動作,,役割,,起動前待機時間,備考,
,,start,60s,,,,restart,,,,,,
,,monitor,60s,,10s,,restart,,,,,,
,,stop,60s,,,,fence,,,,,,
,,,,,,,,,,,,,
,PRIMITIVE,,,,,,,,,,,,
,P,id,,class,,provider,,type,,,,,
#,,リソースID,,class,,provider,,type,,概要,,,
,,ipaddr,,ocf,,heartbeat,,IPaddr2,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,options,ip,,{{ ipaddr.ip }},,,,,,,,
,,,nic,,{{ ipaddr.nic }},,,,,,,,
,,,cidr_netmask,,{{ ipaddr.cidr_netmask }},,,,,,,,
,O,type,timeout,,interval,,on-fail,,role,,start-delay,,
#,,オペレーション,タイムアウト値,,監視間隔,,障害時の動作,,役割,,起動前待機時間,備考,
,,start,60s,,,,restart,,,,,,
,,monitor,60s,,10s,,restart,,,,,,
,,stop,60s,,,,fence,,,,,,
,,,,,,,,,,,,,
,PRIMITIVE,,,,,,,,,,,,
,P,id,,class,,provider,,type,,,,,
#,,リソースID,,class,,provider,,type,,概要,,,
,,pgsql,,ocf,,linuxhajp,,pgsql,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,options,pgctl,,{{ pgsql.pgctl }},,,,,,,,
,,,psql,,{{ pgsql.psql }},,,,,,,,
,,,pgdata,,{{ pgsql.pgdata }},,,,,,,,
,,,pgdba,,postgres,,,,,,,,
,,,pgport,,{{ pgsql.pgport }},,,,,,,,
,,,pgdb,,template1,,,,,,,,
,O,type,timeout,,interval,,on-fail,,role,,start-delay,,
#,,オペレーション,タイムアウト値,,監視間隔,,障害時の動作,,役割,,起動前待機時間,備考,
,,start,300s,,,,restart,,,,,,
,,monitor,60s,,10s,,restart,,,,,,
,,stop,300s,,,,fence,,,,,,
,,,,,,,,,,,,,
,PRIMITIVE,,,,,,,,,,,,
,P,id,,class,,provider,,type,,,,,
#,,リソースID,,class,,provider,,type,,概要,,,
,,ping,,ocf,,pacemaker,,ping,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,options,name,,ping-status,,,,,,,,
,,,host_list,,{{ ping.host_list }},,,,,,,,
,,,attempts,,2,,,,,,,,
,,,timeout,,2,,,,,,,,
,,,debug,,true,,,,,,,,
,O,type,timeout,,interval,,on-fail,,role,,start-delay,,
#,,オペレーション,タイムアウト値,,監視間隔,,障害時の動作,,役割,,起動前待機時間,備考,
,,start,60s,,,,restart,,,,,,
,,monitor,60s,,10s,,restart,,,,,,
,,stop,60s,,,,fence,,,,,,
,,,,,,,,,,,,,
#表 8-1 クラスタ設定　…　STONITHリソース,,,,,,,,,,,,,
,STONITH,,,,,,,,,,,,
,P,id,,type,,,,,,,,,
#,,STONITHリソースID,,type,,,,,,概要,,,
,,fence1-ipmilan,,fence_ipmilan,,,,,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,options,pcmk_host_list,,{{ groups.hacluster_vbmc[0] }},,,,,,,,
,,,ip,,{{ hostvars[groups.hacluster_vbmc[0]].IPMI_IP }},,,,,IPMIポートのIPアドレス,,,
,,,username,,{{ hostvars[groups.hacluster_vbmc[0]].IPMI_USER }},,,,,,,,
,,,password,,{{ hostvars[groups.hacluster_vbmc[0]].IPMI_PASS }},,,,,,,,
,,,lanplus,,1,,,,,,,,
,O,type,timeout,,interval,,on-fail,,,,,,
#,,オペレーション,タイムアウト値,,監視間隔,,障害時の動作,,,備考,,,
,,start,60s,,,,restart,,,,,,
,,monitor,60s,,3600s,,restart,,,,,,
,,stop,60s,,,,ignore,,,,,,
,,,,,,,,,,,,,
,STONITH,,,,,,,,,,,,
,P,id,,type,,,,,,,,,
#,,STONITHリソースID,,type,,,,,,概要,,,
,,fence2-ipmilan,,fence_ipmilan,,,,,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,options,pcmk_host_list,,{{ groups.hacluster_vbmc[1] }},,,,,,,,
,,,ip,,{{ hostvars[groups.hacluster_vbmc[1]].IPMI_IP }},,,,,IPMIポートのIPアドレス,,,
,,,username,,{{ hostvars[groups.hacluster_vbmc[1]].IPMI_USER }},,,,,,,,
,,,password,,{{ hostvars[groups.hacluster_vbmc[1]].IPMI_PASS }},,,,,,,,
,,,lanplus,,1,,,,,,,,
,O,type,timeout,,interval,,on-fail,,,,,,
#,,オペレーション,タイムアウト値,,監視間隔,,障害時の動作,,,備考,,,
,,start,60s,,,,restart,,,,,,
,,monitor,60s,,3600s,,restart,,,,,,
,,stop,60s,,,,ignore,,,,,,
,,,,,,,,,,,,,
#表 9-1 クラスタ設定　…　リソース配置制約 (ノード),,,,,,,,,,,,,
,LOCATION_NODE,,,,,,,,,,,,
,,rsc,,prefers/avoids,,node,,score,,,,,
#,,リソースID,,prefers/avoids,,ノード,,スコア,,備考 (※roleを設定したい場合は、表9-2 を使用してください),,,
,,pgsql-group,,prefers,,{{ groups.hacluster[0] }},,200,,,,,
,,,,,,{{ groups.hacluster[1] }},,100,,,,,
,,fence1-ipmilan,,avoids,,{{ groups.hacluster[0] }},,,,,,,
,,fence2-ipmilan,,avoids,,{{ groups.hacluster[1] }},,,,,,,
,,,,,,,,,,,,,
#表 9-2 クラスタ設定　…　リソース配置制約 (ルール),,,,,,,,,,,,,
,LOCATION_RULE,,,,,,,,,,,,
,,rsc,,score,bool_op,attribute,,op,value,,role,,
#,,リソースID,,スコア,and/or,条件属性名,,条件,条件値,,役割,備考,
,,pgsql-group,,-INFINITY,or,ping-status,,lt,1,,,,
,,,,,,ping-status,,not_defined,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#表 10-1 クラスタ設定　…　リソース同居制約,,,,,,,,,,,,,
,COLOCATION,,,,,,,,,,,,
,,rsc,,with-rsc,,score,,rsc-role,,with-rsc-role,,,
#,,制約関連リソースID,,制約対象リソースID,,スコア(重み付け),,制約関連リソースの役割,,制約対象リソースの役割,,備考,
,,pgsql-group,,ping-clone,,INFINITY,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#表 11-1 クラスタ設定　…　リソース起動順序制約,,,,,,,,,,,,,
,ORDER,,,,,,,,,,,,
,,first-rsc,,then-rsc,,kind,,first-action,,then-action,,symmetrical,
#,,先に起動するリソースID,,後に起動するリソースID,,Optional/Mandatory/Serialize,,先起動ﾘｿｰｽのアクション,,後起動ﾘｿｰｽのアクション,,起動と逆順に停止(true/false),備考
,,ping-clone,,pgsql-group,,,,,,,,false,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#表 12-1 クラスタ設定　…　ALERT設定,,,,,,,,,,,,,
,ALERT,,,,,,,,,,,,
,P,path,,,,,,,,,,,
#,,スクリプトを指定,,,,,,,,概要,,,
,,,,,,,,,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,R,recipient,,,,,,,,,,,
#,,受信者を指定,,,,,,,,概要,,,
,,,,,,,,,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,R,recipient,,,,,,,,,,,
#,,受信者を指定,,,,,,,,概要,,,
,,,,,,,,,,,,,
,A,type,name,,value,,,,,,,,
#,,パラメータ種別,項目,,設定内容,,,,,概要,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#表 13-1 クラスタ設定　…　追加設定,,,,,,,,,,,,,
,ADDITIONAL_CONFIG,,,,,,,,,,,,
,,config,,,,,,,,,,,
#,,追加設定 (記述内容がそのまま出力されます),,,,,,,,,備考,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
,,,,,,,,,,,,,
#,※1.  空行 (中間ファイル時に、カンマのみの行) → OK,,,,,,,,,,,,
#,※2.  コメント行は、列Aの先頭に「#」を記述する。,,,,,,,,,,,,
